!function(r){var c=function(){this.options={range:!1,mode:"plain",autocalculate:!0,color:"#3498db",step:1,vLabels:!1},this.coordinates={startSkate:{min:0,max:0},endSkate:{min:0,max:0}},this.selector=null,this.startSkate=null,this.endSkate=null,this.progressBar=null,this.enabledSkater=null,this.selected={start:{value:0}},this.setEvendHandlers=function(){var e=this;e.startSkate.on("mousedown touchstart",function(){e.enabledSkater="startSkate"}),e.options.range&&e.endSkate.on("mousedown touchstart",function(){e.enabledSkater="endSkate"}),r(document).on("mouseup touchend",function(){e.checkSelection(null),e.enabledSkater=null}),r(document).on("mousemove touchmove",function(t){e.enabledSkater&&(e.checkSelection(null),(t=t.pageX-e.selector.offset().left)<e.coordinates[e.enabledSkater].min?t=e.coordinates[e.enabledSkater].min:t>e.coordinates[e.enabledSkater].max&&(t=e.coordinates[e.enabledSkater].max),e[e.enabledSkater].css("left",t))}),this.progressBar.on("click tap",function(t){e.progressBarSelection(t.pageX)})},this.init=function(){var d=this,l=[];"plain"===this.options.mode&&(d.options.data.size=100,d.options.data=[this.options.data]),d.selector.addClass("ds-container"),d.options.autocalculate&&"categorized"===this.options.mode&&c.autocalculateCategoriesSizes(d.options.data),r.each(d.options.data,function(t,e){var s=e.exclude?c.getExcludedValuesPlain(e):[],a='<div class="ds-category" data-category="'+(e.id||e.name)+'" style="width:'+e.size+"%;"+(e.color?"background:"+e.color:"")+'"><span class="ds-category-title">'+(e.name||"")+'</span><span class="ds-category-start">'+e.start+"</span>",n=e.end-e.start-s.length,o=d.selector.width()/100*e.size/n,i=0;d.selected.start.value=e.start,"categorized"===d.options.mode&&(d.selected.start.category=e.id||e.name);for(var r=e.start;r<e.end;r++)(i=r)+d.options.step-1>e.end&&(i=e.end),~s.indexOf(r)||(a+='<span class="ds-item" data-year="'+i+'" style="width:'+o*d.options.step+'px">'+(d.options.vLabels&&r!=e.start&&r!=e.end?r:"")+"</span>",r=r+d.options.step-1);t===d.options.data.length-1&&(a+='<span class="ds-category-end">'+e.end+"</span>",d.options.range&&(d.selected.end={},d.selected.end.value=e.end,"categorized"===d.options.mode&&(d.selected.end.category=e.id||e.name))),a+="</div>",l.push(a)});var t='<div class="ds-skate"><span class="ds-skate-year-mark">'+d.selected.start.value+'</span></div><div class="ds-progress">'+l.join("")+" </div>";this.options.range&&(t+='<div class="ds-end-skate"><span class="ds-skate-year-mark">'+d.selected.end.value+"</span></div>"),this.selector.html(t),this.startSkate=this.selector.find(".ds-skate"),this.options.range&&(this.endSkate=this.selector.find(".ds-end-skate")),this.progressBar=this.selector.find(".ds-progress"),this.options.color&&this.progressBar.css("background",this.options.color),this.selector.attr("ondragstart","return false"),this.calculateAndSetCoordinates(),this.setEvendHandlers()},this.checkSelection=function(a){var n,o,i=this,t=null;if(!!a)i.options.range||(t="start"),t=i.options.range&&parseInt(i.endSkate.css("left"),10)-a<a-parseInt(i.startSkate.css("left"),10)?(i.endSkate.css("left",a),"end"):(i.startSkate.css("left",a),"start");else{if(!i[i.enabledSkater])return;a=parseInt(i[i.enabledSkater].css("left"),10)}"endSkate"===i.enabledSkater&&a===this.coordinates.endSkate.max&&("categorized"===i.options.mode?(n=i.options.data[i.options.data.length-1].end,o=i.options.data[i.options.data.length-1].name):n=i.options.data[0].end),n||i.progressBar.find(".ds-item").each(function(t,e){var s=(e=r(e)).offset().left-i.selector.offset().left;if(s<=a&&s+e.width()>a)return n=+e.attr("data-year"),o=e.parent().attr("data-category"),!1}),t=t||(i.enabledSkater?i.enabledSkater.split("Skate")[0]:null),n&&n!==this.selected[t].value&&(i.selected[t].value=+n,"categorized"===i.options.mode&&(i.selected[t].category=o),i.updateSelectedLabels(),i.options.onChange&&"function"==typeof i.options.onChange&&i.onChange())},this.onChange=function(){this.options.onChange(this.selected)},this.progressBarSelection=function(t){this.checkSelection(t-r(".ds-container").offset().left)},this.updateSelectedLabels=function(){this.updateCoordinates(),this.startSkate.children(".ds-skate-year-mark").html(this.selected.start.value),this.options.range&&this.endSkate.children(".ds-skate-year-mark").html(this.selected.end.value)},this.updateCoordinates=function(){this.options.range&&(this.coordinates.startSkate.max=parseInt(this.endSkate.css("left"),10),this.coordinates.endSkate.min=parseInt(this.startSkate.css("left"),10))},this.calculateAndSetCoordinates=function(){this.coordinates.startSkate.max=this.selector.width()-this.startSkate.width()-parseInt(this.startSkate.css("border-width"),10),this.options.range&&(this.coordinates.endSkate.max=this.selector.width()-this.endSkate.width()-parseInt(this.endSkate.css("border-width"),10))},this.select=function(t){var e,s=r(".ds-container").offset().left;if("object"==typeof t){if(t.start){if(this.selected.start.value=t.start,!(e=r('.ds-item[data-year="'+t.start+'"]')).length)return console.warn("RangeRover -> select: element `"+t.start+"` is not found."),this;var a=e.offset().left;this.startSkate.css("left",a-s)}if(t.end){if(this.selected.end.value=t.start,!(e=r('.ds-item[data-year="'+t.start+'"]')).length)return console.warn("RangeRover -> select: element `"+t.start+"` is not found."),this;a=e.offset().left;this.endSkate.css("left",a-s)}}else{if(this.selected.start.value=t,!(e=r('.ds-item[data-year="'+t+'"]')).length)return console.warn("RangeRover -> select: element `"+t+"` is not found."),this;a=e.offset().left;this.startSkate.css("left",a-s)}this.updateSelectedLabels()}};c.autocalculateCategoriesSizes=function(t){var e=t.reduce(function(t,e,s){return 1===s?t.end-t.start+(e.end-e.start):t+(e.end-e.start)});return t.map(function(t){t.size=100/e*(t.end-t.start)})},c.getExcludedValuesPlain=function(t){var a=[];return r.each(t.exclude,function(t,e){if("object"==typeof e&&e.start&&e.end)for(var s=e.start;s<=e.end;s++)a.push(s);else a.push(e)}),a},c.isArray=function(t){if("[object Array]"===Object.prototype.toString.call(t))return!0},r.fn.extend({rangeRover:function(t){var e=new c;if(e.options=r.extend(e.options,t),!e.options.data||c.isArray(e.options.data)&&!e.options.data.length)console.warn("RangeRover -> please provide data");else if("plain"!==e.options.mode||!c.isArray(e.options.data)&&"object"==typeof e.options.data){if("categorized"!==e.options.mode||c.isArray(e.options.data))return e.selector=r(this),e.init(),t.onInit&&"function"==typeof t.onInit&&t.onInit(),e;console.warn("RangeRover -> `data` must be array in `categorized` mode")}else console.warn("RangeRover -> `data` must be object in `plain` mode")}})}(jQuery);